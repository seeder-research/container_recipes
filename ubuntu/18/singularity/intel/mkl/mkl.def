BootStrap: localimage
From: pre.sif

%files
    daal       /opt
    iomp       /opt
    ipp        /opt
    mkl        /opt
    mkl_ilp64  /opt
    mpi        /opt
    pstl       /opt
    tbb_gcc47  /opt

%post
    cd /opt && \
    wget --quiet --no-check-certificate \
      https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2023.PUB && \
    apt-key add /opt/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2023.PUB && \
    wget --quiet --no-check-certificate \
      https://apt.repos.intel.com/setup/intelproducts.list -O /etc/apt/sources.list.d/intelproducts.list && \
    apt-get update && \
    apt-get install -y \
      intel-mkl-2019.4-070 \
      intel-tbb-2019.6-070 \
      intel-ipp-2019.4-070 \
      intel-daal-2019.4-070 \
      intel-mpi-2019.4-070 && \
    mkdir -p /usr/local/modulefiles/dev/intel && \
    cd /usr/local/modulefiles/dev/intel && \
    mv /opt/daal \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/ipp \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/iomp \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/mkl \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/mkl_ilp64 \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/tbb_gcc47 \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/mpi \
      /usr/local/modulefiles/dev/intel/. && \
    mv /opt/pstl \
      /usr/local/modulefiles/dev/intel/. && \
    rm -rf \
      /opt/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2023.PUB \
      /var/lib/apt/lists/*

%appenv mkl
. /etc/profile.d/modules.sh
module load intel/mkl
module load intel/ipp
module load intel/iomp
module load intel/daal
module load intel/tbb_gcc47
module load intel/pstl

%appenv mklmpi
. /etc/profile.d/modules.sh
module load intel/mkl
module load intel/ipp
module load intel/iomp
module load intel/daal
module load intel/tbb_gcc47
module load intel/pstl
module load intel/mpi
